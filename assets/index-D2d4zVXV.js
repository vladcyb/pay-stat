var F=s=>{throw TypeError(s)};var _=(s,t,e)=>t.has(s)||F("Cannot "+e);var a=(s,t,e)=>(_(s,t,"read from private field"),e?e.call(s):t.get(s)),u=(s,t,e)=>t.has(s)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),p=(s,t,e,r)=>(_(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const E={1:"Еда",2:"Фастфуд",3:"Сладости",4:"Алкоголь",5:"Кафе",6:"Машина",7:"Транспорт",8:"Образование",9:"Дом",10:"Развлечения",11:"Путешествия",12:"Одежда",13:"Техника",14:"Спорт",15:"Здоровье",16:"Табак",17:"Аптека",18:"Коммуналка",19:"Телефония",20:"Другое"};function S(s){return document.querySelector(s)}function h(s,t){const e=document.createElement(s);return t&&(e.className=t),e}function $(s){return h("table",s)}function D(s){return h("tr",s)}function f(s){return h("td",s)}function M(s){return h("th",s)}function g(s){return h("div",s)}function P(s){return`${s.slice(6)}.${s.slice(4,6)}.${s.slice(0,4)}`}function A(s){if(typeof s.title!="string")throw new Error("Поле title должно быть типа 'string'.");if(typeof s.payments!="object")throw new Error("Поле 'payments' должно быть типа 'object'.");const{payments:t}=s;Object.entries(t).forEach(([e,r])=>{if(!r||!Array.isArray(r))throw new Error(`Данные за ${e} не являются массивом.`);r.forEach((n,i)=>{if(typeof n!="object"||!n||Array.isArray(n))throw new Error(`Платеж за ${e} не является объектом. Индекс ${i}.`);if(Object.entries({name:"string",category:"number",value:"number"}).forEach(([c,l])=>{if(typeof n[c]!==l)throw new Error(`Поле ${c} должно быть ${l}, а не ${typeof n[c]}.
Дата: ${e}. Индекс: ${i}.`)}),!Object.keys(E).includes(String(n.category)))throw new Error(`Платеж за ${e} содержит недопустимое поле category (${n.category}). Индекс ${i}.`)})})}var d;class H{constructor(t,e=""){u(this,d);p(this,d,$(e)),this.addHeader(),t.toSorted((r,n)=>n.value-r.value).forEach(r=>{this.addPayment(r)})}addHeader(){const t=D(`${a(this,d).className}__tr`);["Наименование","Стоимость","Категория"].forEach(e=>{const r=M(`${a(this,d).className}__th`);r.innerText=e,t.append(r)}),a(this,d).append(t)}render(){return a(this,d)}addPayment(t){const e=D(),r=f(),n=f(),i=f();r.innerText=t.name,n.innerText=t.value,i.innerText=E[t.category],e.append(r,n,i),a(this,d).append(e)}}d=new WeakMap;var y;class x{constructor(){u(this,y);p(this,y,$())}render(){return a(this,y)}addCategory(t,e){const r=D(),n=f(),i=f();n.innerText=E[t],i.innerText=e,r.append(n,i),a(this,y).append(r)}addTotal(t){const e=D("day__selected-row"),r=f(),n=f();r.innerText="Итого",n.innerText=t,e.append(r,n),a(this,y).append(e)}}y=new WeakMap;var m,w,b;class N{constructor(t,e,r){u(this,m);u(this,w);u(this,b);p(this,m,t),p(this,w,e),p(this,b,[...r].toSorted((n,i)=>i[1]-n[1]))}render(){const t=g("day"),e=g("day__header");e.innerText=P(a(this,m)),t.append(e);const r=g("day__content"),n=new H(a(this,w),"dayTable");r.append(n.render()),t.append(r);const i=g("day__statistics"),o=new x;let c=0;return a(this,b).forEach(([l,C])=>{c+=C,o.addCategory(l,C)}),o.addTotal(c),i.append(o.render()),t.append(i),t}}m=new WeakMap,w=new WeakMap,b=new WeakMap;var v,T;class q{constructor(t,e){u(this,v);u(this,T);p(this,T,t),p(this,v,[...e].toSorted((r,n)=>n[1]-r[1]))}render(){const t=g("totalStatistics"),e=h("h1","totalStatistics__title");e.innerText=a(this,T),t.append(e);const r=h("h2","totalStatistics__subtitle");r.innerText="Общая статистика",t.append(r);const n=h("button","totalStatistics__close");n.innerHTML=`<svg class="totalStatistics__close-img" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18 35.75C8.19695 35.75 0.25 27.8031 0.25 18C0.25 8.19695 8.19695 0.25 18 0.25C27.8031 0.25 35.75 8.19695 35.75 18C35.75 27.8031 27.8031 35.75 18 35.75Z"  stroke="#CDCDCD" stroke-width="0.5"/>
<path d="M26 9.36753L9 26M9 9L26 25.6325" stroke="black"/>
</svg>
`,t.append(n),n.addEventListener("click",()=>{document.querySelector("#statisticsContainer").childNodes.forEach(c=>{c.remove()}),document.querySelector("#initialContent").classList.remove("d-none")});const i=new x;let o=0;return a(this,v).forEach(([c,l])=>{o+=l,i.addCategory(c,l)}),i.addTotal(o),t.append(i.render()),t}}v=new WeakMap,T=new WeakMap;class O extends Map{constructor(t){super(),Object.values(t).flat().forEach(e=>this.add(e.category,e.value))}add(t,e){this.has(t)?this.set(t,this.get(t)+e):this.set(t,e)}}class J{constructor(){this.handleFileContent=this.handleFileContent.bind(this),this.handleFileDrop=this.handleFileDrop.bind(this),this.handleFileInput=this.handleFileInput.bind(this),this.handleJsonSubmit=this.handleJsonSubmit.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),document.addEventListener("dragover",this.handleDragOver),document.addEventListener("dragleave",this.handleDragLeave),document.addEventListener("drop",this.handleFileDrop),S("#file-input").addEventListener("change",this.handleFileInput)}handleFileContent(t){try{const e=JSON.parse(t);A(e);const r=document.querySelector("#initialContent");r&&r.classList.add("d-none"),this.renderPayments(e)}catch(e){alert(e.message||"Ошибка при чтении данных. Убедитесь, что данные содержат корректный JSON.")}}handleFileDrop(t){t.preventDefault();const e=t.dataTransfer.files[0];if(!e)return;const r=new FileReader;r.onload=n=>this.handleFileContent(n.target.result),r.readAsText(e)}handleFileInput(t){const e=t.target.files[0];if(!e)return;const r=new FileReader;r.onload=n=>this.handleFileContent(n.target.result),r.readAsText(e)}handleJsonSubmit(){const e=S("#json-input").value.trim();e&&this.handleFileContent(e)}handleDragOver(t){t.preventDefault()}handleDragLeave(t){t.preventDefault()}renderPayments(t){const e=S("#statisticsContainer"),{payments:r,title:n}=t,i=g("container"),o=new O(r),c=new q(n,o);i.append(c.render());const l=h("h2","dailyStatisticsTitle");l.innerText="Статистика по дням",i.append(l),Object.entries(r).forEach(([C,L])=>{const j=new O(L),I=new N(C,L,j);i.append(I.render())}),e.innerHTML="",e.append(i)}}document.addEventListener("DOMContentLoaded",()=>{S(".categories-format-example").innerHTML=Object.entries(E).map(([s,t])=>`<div>${s} - ${t}</div>`).join(""),new J});
