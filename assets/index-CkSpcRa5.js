var _=i=>{throw TypeError(i)};var F=(i,t,e)=>t.has(i)||_("Cannot "+e);var a=(i,t,e)=>(F(i,t,"read from private field"),e?e.call(i):t.get(i)),u=(i,t,e)=>t.has(i)?_("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),p=(i,t,e,s)=>(F(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const D={1:"Еда",2:"Фастфуд",3:"Сладости",4:"Алкоголь",5:"Кафе",6:"Машина",7:"Транспорт",8:"Образование",9:"Дом",10:"Развлечения",11:"Путешествия",12:"Одежда",13:"Техника",14:"Спорт",15:"Здоровье",16:"Табак",18:"Коммуналка",19:"Телефония",20:"Другое"};function f(i){return document.querySelector(i)}function h(i,t){const e=document.createElement(i);return t&&(e.className=t),e}function O(i){return h("table",i)}function L(i){return h("tr",i)}function y(i){return h("td",i)}function M(i){return h("th",i)}function m(i){return h("div",i)}function P(i){return`${i.slice(6)}.${i.slice(4,6)}.${i.slice(0,4)}`}function A(i){if(typeof i.title!="string")throw new Error("Поле title должно быть типа 'string'.");if(typeof i.payments!="object")throw new Error("Поле 'payments' должно быть типа 'object'.");const{payments:t}=i;Object.entries(t).forEach(([e,s])=>{if(!s||!Array.isArray(s))throw new Error(`Данные за ${e} не являются массивом.`);s.forEach((n,r)=>{if(typeof n!="object"||!n||Array.isArray(n))throw new Error(`Платеж за ${e} не является объектом. Индекс ${r}.`);if(Object.entries({name:"string",category:"number",value:"number"}).forEach(([c,l])=>{if(typeof n[c]!==l)throw new Error(`Поле ${c} должно быть ${l}, а не ${typeof n[c]}.
Дата: ${e}. Индекс: ${r}.`)}),!Object.keys(D).includes(String(n.category)))throw new Error(`Платеж за ${e} содержит недопустимое поле category (${n.category}). Индекс ${r}.`)})})}var d;class H{constructor(t,e=""){u(this,d);p(this,d,O(e)),this.addHeader(),t.toSorted((s,n)=>n.value-s.value).forEach(s=>{this.addPayment(s)})}addHeader(){const t=L(`${a(this,d).className}__tr`);["Наименование","Стоимость","Категория"].forEach(e=>{const s=M(`${a(this,d).className}__th`);s.innerText=e,t.append(s)}),a(this,d).append(t)}render(){return a(this,d)}addPayment(t){const e=L(),s=y(),n=y(),r=y();s.innerText=t.name,n.innerText=t.value,r.innerText=D[t.category],e.append(s,n,r),a(this,d).append(e)}}d=new WeakMap;var g;class ${constructor(){u(this,g);p(this,g,O())}render(){return a(this,g)}addCategory(t,e){const s=L(),n=y(),r=y();n.innerText=D[t],r.innerText=e,s.append(n,r),a(this,g).append(s)}addTotal(t){const e=L("day__selected-row"),s=y(),n=y();s.innerText="Итого",n.innerText=t,e.append(s,n),a(this,g).append(e)}}g=new WeakMap;var w,C,v;class N{constructor(t,e,s){u(this,w);u(this,C);u(this,v);p(this,w,t),p(this,C,e),p(this,v,[...s].toSorted((n,r)=>r[1]-n[1]))}render(){const t=m("day"),e=m("day__header");e.innerText=P(a(this,w)),t.append(e);const s=m("day__content"),n=new H(a(this,C),"dayTable");s.append(n.render()),t.append(s);const r=m("day__statistics"),o=new $;let c=0;return a(this,v).forEach(([l,S])=>{c+=S,o.addCategory(l,S)}),o.addTotal(c),r.append(o.render()),t.append(r),t}}w=new WeakMap,C=new WeakMap,v=new WeakMap;var b,T;class R{constructor(t,e){u(this,b);u(this,T);p(this,T,t),p(this,b,[...e].toSorted((s,n)=>n[1]-s[1]))}render(){const t=m("totalStatistics"),e=h("h1","totalStatistics__title");e.innerText=a(this,T),t.append(e);const s=h("h2","totalStatistics__subtitle");s.innerText="Общая статистика",t.append(s);const n=h("button","totalStatistics__close");n.innerHTML=`<svg class="totalStatistics__close-img" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18 35.75C8.19695 35.75 0.25 27.8031 0.25 18C0.25 8.19695 8.19695 0.25 18 0.25C27.8031 0.25 35.75 8.19695 35.75 18C35.75 27.8031 27.8031 35.75 18 35.75Z"  stroke="#CDCDCD" stroke-width="0.5"/>
<path d="M26 9.36753L9 26M9 9L26 25.6325" stroke="black"/>
</svg>
`,t.append(n),n.addEventListener("click",()=>{document.querySelector("#statisticsContainer").childNodes.forEach(c=>{c.remove()}),f("#initialContent").classList.remove("d-none"),location.search&&(location.search="")});const r=new $;let o=0;return a(this,b).forEach(([c,l])=>{o+=l,r.addCategory(c,l)}),r.addTotal(o),t.append(r.render()),t}}b=new WeakMap,T=new WeakMap;class x extends Map{constructor(t){super(),Object.values(t).flat().forEach(e=>this.add(e.category,e.value))}add(t,e){this.has(t)?this.set(t,this.get(t)+e):this.set(t,e)}}class J{constructor(){this.handleFileContent=this.handleFileContent.bind(this),this.handleFileDrop=this.handleFileDrop.bind(this),this.handleFileInput=this.handleFileInput.bind(this),this.handleJsonSubmit=this.handleJsonSubmit.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),document.addEventListener("dragover",this.handleDragOver),document.addEventListener("dragleave",this.handleDragLeave),document.addEventListener("drop",this.handleFileDrop),f("#file-input").addEventListener("change",this.handleFileInput);const e=new URLSearchParams(location.search).get("source");e?this.handleSource(e):this.showInitialContent()}async handleSource(t){const e=await fetch(t),s=await e.text();e.status===200?this.handleFileContent(s):(alert("Недействительная ссылка"),this.showInitialContent())}showInitialContent(){f(".initialContent").classList.remove("d-none")}hideInitialContent(){f(".initialContent").classList.add("d-none")}handleFileContent(t){try{const e=JSON.parse(t);A(e),f("#initialContent")&&this.hideInitialContent(),this.renderPayments(e)}catch(e){this.showInitialContent(),alert(e.message||"Ошибка при чтении данных. Убедитесь, что данные содержат корректный JSON.")}}handleFileDrop(t){t.preventDefault();const e=t.dataTransfer.files[0];if(!e)return;const s=new FileReader;s.onload=n=>this.handleFileContent(n.target.result),s.readAsText(e)}handleFileInput(t){const e=t.target.files[0];if(!e)return;const s=new FileReader;s.onload=n=>this.handleFileContent(n.target.result),s.readAsText(e)}handleJsonSubmit(){const e=f("#json-input").value.trim();e&&this.handleFileContent(e)}handleDragOver(t){t.preventDefault()}handleDragLeave(t){t.preventDefault()}renderPayments(t){const e=f("#statisticsContainer"),{payments:s,title:n}=t,r=m("container"),o=new x(s),c=new R(n,o);r.append(c.render());const l=h("h2","dailyStatisticsTitle");l.innerText="Статистика по дням",r.append(l),Object.entries(s).forEach(([S,E])=>{const I=new x(E),j=new N(S,E,I);r.append(j.render())}),e.innerHTML="",e.append(r)}}document.addEventListener("DOMContentLoaded",()=>{f(".categories-format-example").innerHTML=Object.entries(D).map(([i,t])=>`<div class="categories-format-example__line">${i} - ${t}</div>`).join(""),new J});
