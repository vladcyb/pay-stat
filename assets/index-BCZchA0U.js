var L=n=>{throw TypeError(n)};var x=(n,e,t)=>e.has(n)||L("Cannot "+t);var o=(n,e,t)=>(x(n,e,"read from private field"),t?t.call(n):e.get(n)),d=(n,e,t)=>e.has(n)?L("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),u=(n,e,t,s)=>(x(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const O={1:"Еда",2:"Фастфуд",3:"Сладости",4:"Алкоголь",5:"Кафе",6:"Машина",7:"Транспорт",8:"Образование",9:"Дом",10:"Развлечения",11:"Путешествия",12:"Одежда",13:"Техника",14:"Спорт",15:"Здоровье",16:"Другое"};function _(n){return document.querySelector(n)}function p(n,e){const t=document.createElement(n);return e&&(t.className=e),t}function j(n){return p("table",n)}function S(n){return p("tr",n)}function f(n){return p("td",n)}function N(n){return p("th",n)}function g(n){return p("div",n)}function H(n){return`${n.slice(6)}.${n.slice(4,6)}.${n.slice(0,4)}`}function R(n){if(typeof n.title!="string")throw new Error("Поле title должно быть типа 'string'.");if(typeof n.payments!="object")throw new Error("Поле 'payments' должно быть типа 'object'.");const{payments:e}=n;Object.entries(e).forEach(([t,s])=>{if(!s||!Array.isArray(s))throw new Error(`Данные за ${t} не являются массивом.`);s.forEach((r,a)=>{if(typeof r!="object"||!r||Array.isArray(r))throw new Error(`Платеж за ${t} не является объектом. Индекс ${a}.`);if(Object.entries({name:"string",category:"number",value:"number"}).forEach(([c,y])=>{if(typeof r[c]!==y)throw new Error(`Поле ${c} должно быть ${y}, а не ${typeof r[c]}.
Дата: ${t}. Индекс: ${a}.`)}),!Object.keys(O).includes(String(r.category)))throw new Error(`Платеж за ${t} содержит недопустимое поле category (${r.category}). Индекс ${a}.`)})})}var l;class V{constructor(e,t=""){d(this,l);u(this,l,j(t)),this.addHeader(),e.toSorted((s,r)=>r.value-s.value).forEach(s=>{this.addPayment(s)})}addHeader(){const e=S(`${o(this,l).className}__tr`);["Наименование","Стоимость","Категория"].forEach(t=>{const s=N(`${o(this,l).className}__th`);s.innerText=t,e.append(s)}),o(this,l).append(e)}render(){return o(this,l)}addPayment(e){const t=S(),s=f(),r=f(),a=f();s.innerText=e.name,r.innerText=e.value,a.innerText=O[e.category],t.append(s,r,a),o(this,l).append(t)}}l=new WeakMap;var h;class M{constructor(){d(this,h);u(this,h,j())}render(){return o(this,h)}addCategory(e,t){const s=S(),r=f(),a=f();r.innerText=O[e],a.innerText=t,s.append(r,a),o(this,h).append(s)}addTotal(e){const t=S("day__selected-row"),s=f(),r=f();s.innerText="Итого",r.innerText=e,t.append(s,r),o(this,h).append(t)}}h=new WeakMap;var T,w,b;class q{constructor(e,t,s){d(this,T);d(this,w);d(this,b);u(this,T,e),u(this,w,t),u(this,b,[...s].toSorted((r,a)=>a[1]-r[1]))}render(){const e=g("day"),t=g("day__header");t.innerText=H(o(this,T)),e.append(t);const s=g("day__content"),r=new V(o(this,w),"dayTable");s.append(r.render()),e.append(s);const a=g("day__statistics"),i=new M;let c=0;return o(this,b).forEach(([y,m])=>{c+=m,i.addCategory(y,m)}),i.addTotal(c),a.append(i.render()),e.append(a),e}}T=new WeakMap,w=new WeakMap,b=new WeakMap;var v,E;class I{constructor(e,t){d(this,v);d(this,E);u(this,E,e),u(this,v,[...t].toSorted((s,r)=>r[1]-s[1]))}render(){const e=g("totalStatistics"),t=p("h1","totalStatistics__title");t.innerText=o(this,E),e.append(t);const s=p("h2","totalStatistics__subtitle");s.innerText="Общая статистика",e.append(s);const r=new M;let a=0;return o(this,v).forEach(([i,c])=>{a+=c,r.addCategory(i,c)}),r.addTotal(a),e.append(r.render()),e}}v=new WeakMap,E=new WeakMap;class D extends Map{constructor(e){super(),Object.values(e).flat().forEach(t=>this.add(t.category,t.value))}add(e,t){this.has(e)?this.set(e,this.get(e)+t):this.set(e,t)}}let $=null;function J(n){n.preventDefault();const e=n.dataTransfer.files[0];if(!e)return;const t=new FileReader;t.onload=s=>{try{$=JSON.parse(s.target.result),R($),K($)}catch(r){alert(r.message||"Ошибка при чтении файла. Убедитесь, что файл содержит корректный JSON.")}},t.readAsText(e)}function z(n){n.preventDefault()}function B(n){n.preventDefault()}function K(n){const e=_("#root"),t=_("#drop-zone");e.innerHTML="",e.append(t);const{payments:s,title:r}=n,a=g("container");e.append(a);const i=_("#initial-message");i&&(i.style.display=Object.keys(s).length>0?"none":"block");const c=new D(s),y=new I(r,c);a.append(y.render());const m=p("h2","dailyStatisticsTitle");m.innerText="Статистика по дням",a.append(m),Object.entries(s).forEach(([P,C])=>{const A=new D(C),F=new q(P,C,A);a.append(F.render())})}document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("dragover",z),document.addEventListener("dragleave",B),document.addEventListener("drop",J),document.getElementById("initialMessage").classList.remove("initialMessage_hidden")});
