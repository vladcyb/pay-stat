var _=r=>{throw TypeError(r)};var F=(r,t,e)=>t.has(r)||_("Cannot "+e);var a=(r,t,e)=>(F(r,t,"read from private field"),e?e.call(r):t.get(r)),u=(r,t,e)=>t.has(r)?_("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),p=(r,t,e,s)=>(F(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const D={1:"Еда",2:"Фастфуд",3:"Сладости",4:"Алкоголь",5:"Кафе",6:"Машина",7:"Транспорт",8:"Образование",9:"Дом",10:"Развлечения",11:"Путешествия",12:"Одежда",13:"Техника",14:"Спорт",15:"Здоровье",16:"Табак",18:"Коммуналка",19:"Телефония",20:"Другое"};function f(r){return document.querySelector(r)}function h(r,t){const e=document.createElement(r);return t&&(e.className=t),e}function O(r){return h("table",r)}function L(r){return h("tr",r)}function m(r){return h("td",r)}function M(r){return h("th",r)}function g(r){return h("div",r)}function P(r){return`${r.slice(6)}.${r.slice(4,6)}.${r.slice(0,4)}`}function A(r){if(typeof r.title!="string")throw new Error("Поле title должно быть типа 'string'.");if(typeof r.payments!="object")throw new Error("Поле 'payments' должно быть типа 'object'.");const{payments:t}=r;Object.entries(t).forEach(([e,s])=>{if(!s||!Array.isArray(s))throw new Error(`Данные за ${e} не являются массивом.`);s.forEach((n,i)=>{if(typeof n!="object"||!n||Array.isArray(n))throw new Error(`Платеж за ${e} не является объектом. Индекс ${i}.`);if(Object.entries({name:"string",category:"number",value:"number"}).forEach(([c,l])=>{if(typeof n[c]!==l)throw new Error(`Поле ${c} должно быть ${l}, а не ${typeof n[c]}.
Дата: ${e}. Индекс: ${i}.`)}),!Object.keys(D).includes(String(n.category)))throw new Error(`Платеж за ${e} содержит недопустимое поле category (${n.category}). Индекс ${i}.`)})})}var d;class H{constructor(t,e=""){u(this,d);p(this,d,O(e)),this.addHeader(),t.toSorted((s,n)=>n.value-s.value).forEach(s=>{this.addPayment(s)})}addHeader(){const t=L(`${a(this,d).className}__tr`);["Наименование","Стоимость","Категория"].forEach(e=>{const s=M(`${a(this,d).className}__th`);s.innerText=e,t.append(s)}),a(this,d).append(t)}render(){return a(this,d)}addPayment(t){const e=L(),s=m(),n=m(),i=m();s.innerText=t.name,n.innerText=t.value,i.innerText=D[t.category],e.append(s,n,i),a(this,d).append(e)}}d=new WeakMap;var y;class ${constructor(){u(this,y);p(this,y,O())}render(){return a(this,y)}addCategory(t,e){const s=L(),n=m(),i=m();n.innerText=D[t],i.innerText=e,s.append(n,i),a(this,y).append(s)}addTotal(t){const e=L("day__selected-row"),s=m(),n=m();s.innerText="Итого",n.innerText=t,e.append(s,n),a(this,y).append(e)}}y=new WeakMap;var w,v,C;class N{constructor(t,e,s){u(this,w);u(this,v);u(this,C);p(this,w,t),p(this,v,e),p(this,C,[...s].toSorted((n,i)=>i[1]-n[1]))}render(){const t=g("day"),e=g("day__header");e.innerText=P(a(this,w)),t.append(e);const s=g("day__content"),n=new H(a(this,v),"dayTable");s.append(n.render()),t.append(s);const i=g("day__statistics"),o=new $;let c=0;return a(this,C).forEach(([l,S])=>{c+=S,o.addCategory(l,S)}),o.addTotal(c),i.append(o.render()),t.append(i),t}}w=new WeakMap,v=new WeakMap,C=new WeakMap;var b,T;class R{constructor(t,e){u(this,b);u(this,T);p(this,T,t),p(this,b,[...e].toSorted((s,n)=>n[1]-s[1]))}render(){const t=g("totalStatistics"),e=h("h1","totalStatistics__title");e.innerText=a(this,T),t.append(e);const s=h("h2","totalStatistics__subtitle");s.innerText="Общая статистика",t.append(s);const n=h("button","totalStatistics__close");n.innerHTML=`<svg class="totalStatistics__close-img" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18 35.75C8.19695 35.75 0.25 27.8031 0.25 18C0.25 8.19695 8.19695 0.25 18 0.25C27.8031 0.25 35.75 8.19695 35.75 18C35.75 27.8031 27.8031 35.75 18 35.75Z"  stroke="#CDCDCD" stroke-width="0.5"/>
<path d="M26 9.36753L9 26M9 9L26 25.6325" stroke="black"/>
</svg>
`,t.append(n),n.addEventListener("click",()=>{document.querySelector("#statisticsContainer").childNodes.forEach(c=>{c.remove()}),document.querySelector("#initialContent").classList.remove("d-none")});const i=new $;let o=0;return a(this,b).forEach(([c,l])=>{o+=l,i.addCategory(c,l)}),i.addTotal(o),t.append(i.render()),t}}b=new WeakMap,T=new WeakMap;class x extends Map{constructor(t){super(),Object.values(t).flat().forEach(e=>this.add(e.category,e.value))}add(t,e){this.has(t)?this.set(t,this.get(t)+e):this.set(t,e)}}class q{constructor(){this.handleFileContent=this.handleFileContent.bind(this),this.handleFileDrop=this.handleFileDrop.bind(this),this.handleFileInput=this.handleFileInput.bind(this),this.handleJsonSubmit=this.handleJsonSubmit.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),document.addEventListener("dragover",this.handleDragOver),document.addEventListener("dragleave",this.handleDragLeave),document.addEventListener("drop",this.handleFileDrop),f("#file-input").addEventListener("change",this.handleFileInput);const e=new URLSearchParams(location.search).get("source");e?this.handleSource(e):f(".initialContent").classList.remove("initialContent_hidden")}async handleSource(t){const e=await fetch(t),s=await e.text();e.status===200?this.handleFileContent(s):(alert("Недействительная ссылка"),f(".initialContent").classList.remove("initialContent_hidden"))}handleFileContent(t){try{const e=JSON.parse(t);A(e);const s=f("#initialContent");s&&s.classList.add("d-none"),this.renderPayments(e)}catch(e){initialContent.classList.remove("initialContent_hidden"),alert(e.message||"Ошибка при чтении данных. Убедитесь, что данные содержат корректный JSON.")}}handleFileDrop(t){t.preventDefault();const e=t.dataTransfer.files[0];if(!e)return;const s=new FileReader;s.onload=n=>this.handleFileContent(n.target.result),s.readAsText(e)}handleFileInput(t){const e=t.target.files[0];if(!e)return;const s=new FileReader;s.onload=n=>this.handleFileContent(n.target.result),s.readAsText(e)}handleJsonSubmit(){const e=f("#json-input").value.trim();e&&this.handleFileContent(e)}handleDragOver(t){t.preventDefault()}handleDragLeave(t){t.preventDefault()}renderPayments(t){const e=f("#statisticsContainer"),{payments:s,title:n}=t,i=g("container"),o=new x(s),c=new R(n,o);i.append(c.render());const l=h("h2","dailyStatisticsTitle");l.innerText="Статистика по дням",i.append(l),Object.entries(s).forEach(([S,E])=>{const j=new x(E),I=new N(S,E,j);i.append(I.render())}),e.innerHTML="",e.append(i)}}document.addEventListener("DOMContentLoaded",()=>{f(".categories-format-example").innerHTML=Object.entries(D).map(([r,t])=>`<div class="categories-format-example__line">${r} - ${t}</div>`).join(""),new q});
