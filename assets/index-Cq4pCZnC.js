var x=t=>{throw TypeError(t)};var j=(t,e,n)=>e.has(t)||x("Cannot "+n);var i=(t,e,n)=>(j(t,e,"read from private field"),n?n.call(t):e.get(t)),d=(t,e,n)=>e.has(t)?x("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),u=(t,e,n,s)=>(j(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const L={1:"Еда",2:"Фастфуд",3:"Сладости",4:"Алкоголь",5:"Кафе",6:"Машина",7:"Транспорт",8:"Образование",9:"Дом",10:"Развлечения",11:"Путешествия",12:"Одежда",13:"Техника",14:"Спорт",15:"Здоровье",16:"Другое"};function g(t){return document.querySelector(t)}function p(t,e){const n=document.createElement(t);return e&&(n.className=e),n}function M(t){return p("table",t)}function _(t){return p("tr",t)}function h(t){return p("td",t)}function N(t){return p("th",t)}function y(t){return p("div",t)}function P(t){return`${t.slice(6)}.${t.slice(4,6)}.${t.slice(0,4)}`}function H(t){if(typeof t.title!="string")throw new Error("Поле title должно быть типа 'string'.");if(typeof t.payments!="object")throw new Error("Поле 'payments' должно быть типа 'object'.");const{payments:e}=t;Object.entries(e).forEach(([n,s])=>{if(!s||!Array.isArray(s))throw new Error(`Данные за ${n} не являются массивом.`);s.forEach((r,a)=>{if(typeof r!="object"||!r||Array.isArray(r))throw new Error(`Платеж за ${n} не является объектом. Индекс ${a}.`);if(Object.entries({name:"string",category:"number",value:"number"}).forEach(([c,f])=>{if(typeof r[c]!==f)throw new Error(`Поле ${c} должно быть ${f}, а не ${typeof r[c]}.
Дата: ${n}. Индекс: ${a}.`)}),!Object.keys(L).includes(String(r.category)))throw new Error(`Платеж за ${n} содержит недопустимое поле category (${r.category}). Индекс ${a}.`)})})}var l;class J{constructor(e,n=""){d(this,l);u(this,l,M(n)),this.addHeader(),e.toSorted((s,r)=>r.value-s.value).forEach(s=>{this.addPayment(s)})}addHeader(){const e=_(`${i(this,l).className}__tr`);["Наименование","Стоимость","Категория"].forEach(n=>{const s=N(`${i(this,l).className}__th`);s.innerText=n,e.append(s)}),i(this,l).append(e)}render(){return i(this,l)}addPayment(e){const n=_(),s=h(),r=h(),a=h();s.innerText=e.name,r.innerText=e.value,a.innerText=L[e.category],n.append(s,r,a),i(this,l).append(n)}}l=new WeakMap;var m;class F{constructor(){d(this,m);u(this,m,M())}render(){return i(this,m)}addCategory(e,n){const s=_(),r=h(),a=h();r.innerText=L[e],a.innerText=n,s.append(r,a),i(this,m).append(s)}addTotal(e){const n=_("day__selected-row"),s=h(),r=h();s.innerText="Итого",r.innerText=e,n.append(s,r),i(this,m).append(n)}}m=new WeakMap;var T,w,b;class R{constructor(e,n,s){d(this,T);d(this,w);d(this,b);u(this,T,e),u(this,w,n),u(this,b,[...s].toSorted((r,a)=>a[1]-r[1]))}render(){const e=y("day"),n=y("day__header");n.innerText=P(i(this,T)),e.append(n);const s=y("day__content"),r=new J(i(this,w),"dayTable");s.append(r.render()),e.append(s);const a=y("day__statistics"),o=new F;let c=0;return i(this,b).forEach(([f,S])=>{c+=S,o.addCategory(f,S)}),o.addTotal(c),a.append(o.render()),e.append(a),e}}T=new WeakMap,w=new WeakMap,b=new WeakMap;var v,E;class V{constructor(e,n){d(this,v);d(this,E);u(this,E,e),u(this,v,[...n].toSorted((s,r)=>r[1]-s[1]))}render(){const e=y("totalStatistics"),n=p("h1","totalStatistics__title");n.innerText=i(this,E),e.append(n);const s=p("h2","totalStatistics__subtitle");s.innerText="Общая статистика",e.append(s);const r=new F;let a=0;return i(this,v).forEach(([o,c])=>{a+=c,r.addCategory(o,c)}),r.addTotal(a),e.append(r.render()),e}}v=new WeakMap,E=new WeakMap;class D extends Map{constructor(e){super(),Object.values(e).flat().forEach(n=>this.add(n.category,n.value))}add(e,n){this.has(e)?this.set(e,this.get(e)+n):this.set(e,n)}}class q{render(){const e=y();return e.innerHTML=`
    <h2>Формат файла</h2>
        <p>Файл должен быть в формате JSON со следующей структурой:</p>
        <pre class="format-example">${JSON.stringify({title:"Название отчета",payments:{20240329:[{category:1,value:100,name:"помидоры"},{category:2,value:400,name:"бургер"}],20240328:[{category:7,value:500,name:"Такси"}]}},null,2)}
    
        </pre>
        <div class="format-notes">
          <h3>Правила:</h3>
          <ul>
            <li>Даты должны быть в формате ГГГГММДД</li>
            <li>Суммы указываются в любой валюте</li>
            <li>В поле категории указывается номер категории (таблица категорий ниже)</li>
            <li>В один день может быть несколько платежей</li>
            <li>Дни можно писать в любом порядке (они будут отсортированы по дате)</li>
          </ul> 
    `,e}}let $=null;function O(t){try{$=JSON.parse(t),H($),U($)}catch(e){alert(e.message||"Ошибка при чтении данных. Убедитесь, что данные содержат корректный JSON.")}}function B(t){t.preventDefault();const e=t.dataTransfer.files[0];if(!e)return;const n=new FileReader;n.onload=s=>O(s.target.result),n.readAsText(e)}function G(t){const e=t.target.files[0];if(!e)return;const n=new FileReader;n.onload=s=>O(s.target.result),n.readAsText(e)}function K(){const e=g("#json-input").value.trim();e&&O(e)}function z(t){t.preventDefault()}function Q(t){t.preventDefault()}function U(t){const e=g("#statistics-container"),{payments:n,title:s}=t,r=y("container"),a=new D(n),o=new V(s,a);r.append(o.render());const c=p("h2","dailyStatisticsTitle");c.innerText="Статистика по дням",r.append(c),Object.entries(n).forEach(([S,C])=>{const A=new D(C),I=new R(S,C,A);r.append(I.render())});const f=g("#initialMessage");f&&f.classList.add("initialMessage_hidden"),e.innerHTML="",e.append(r)}document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("dragover",z),document.addEventListener("dragleave",Q),document.addEventListener("drop",B),document.querySelector("#format-guide").append(new q().render()),g("#file-input").addEventListener("change",G),g("#submit-json").addEventListener("click",K),document.getElementById("initialMessage").classList.remove("initialMessage_hidden")});
