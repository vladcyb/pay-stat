var F=s=>{throw TypeError(s)};var _=(s,t,e)=>t.has(s)||F("Cannot "+e);var a=(s,t,e)=>(_(s,t,"read from private field"),e?e.call(s):t.get(s)),p=(s,t,e)=>t.has(s)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),f=(s,t,e,i)=>(_(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const D={1:"Еда",2:"Фастфуд",3:"Сладости",4:"Алкоголь",5:"Кафе",6:"Машина",7:"Транспорт",8:"Образование",9:"Дом",10:"Развлечения",11:"Путешествия",12:"Одежда",13:"Техника",14:"Спорт",15:"Здоровье",16:"Табак",18:"Коммуналка",19:"Телефония",20:"Другое",21:"Средства гигиены",22:"Пакеты/контейнеры на кассе"};function d(s){return document.querySelector(s)}function u(s,t){const e=document.createElement(s);return t&&(e.className=t),e}function x(s){return u("table",s)}function L(s){return u("tr",s)}function m(s){return u("td",s)}function M(s){return u("th",s)}function y(s){return u("div",s)}function P(s){return`${s.slice(6)}.${s.slice(4,6)}.${s.slice(0,4)}`}function A(s){if(typeof s.title!="string")throw new Error("Поле title должно быть типа 'string'.");if(typeof s.payments!="object")throw new Error("Поле 'payments' должно быть типа 'object'.");const{payments:t}=s;Object.entries(t).forEach(([e,i])=>{if(!i||!Array.isArray(i))throw new Error(`Данные за ${e} не являются массивом.`);i.forEach((n,r)=>{if(typeof n!="object"||!n||Array.isArray(n))throw new Error(`Платеж за ${e} не является объектом. Индекс ${r}.`);if(Object.entries({name:"string",category:"number",value:"number"}).forEach(([c,l])=>{if(typeof n[c]!==l)throw new Error(`Поле ${c} должно быть ${l}, а не ${typeof n[c]}.
Дата: ${e}. Индекс: ${r}.`)}),!Object.keys(D).includes(String(n.category)))throw new Error(`Платеж за ${e} содержит недопустимое поле category (${n.category}). Индекс ${r}.`)})})}var h;class H{constructor(t,e=""){p(this,h);f(this,h,x(e)),this.addHeader(),t.toSorted((i,n)=>n.value-i.value).forEach(i=>{this.addPayment(i)})}addHeader(){const t=L(`${a(this,h).className}__tr`);["Наименование","Стоимость","Категория"].forEach(e=>{const i=M(`${a(this,h).className}__th`);i.innerText=e,t.append(i)}),a(this,h).append(t)}render(){return a(this,h)}addPayment(t){const e=L(),i=m(),n=m(),r=m();i.innerText=t.name,n.innerText=t.value,r.innerText=D[t.category],e.append(i,n,r),a(this,h).append(e)}}h=new WeakMap;var g;class O{constructor(){p(this,g);f(this,g,x())}render(){return a(this,g)}addCategory(t,e){const i=L(),n=m(),r=m();n.innerText=D[t],r.innerText=e,i.append(n,r),a(this,g).append(i)}addTotal(t){const e=L("day__selected-row"),i=m(),n=m();i.innerText="Итого",n.innerText=t,e.append(i,n),a(this,g).append(e)}}g=new WeakMap;var w,v,C;class J{constructor(t,e,i){p(this,w);p(this,v);p(this,C);f(this,w,t),f(this,v,e),f(this,C,[...i].toSorted((n,r)=>r[1]-n[1]))}render(){const t=y("day"),e=y("day__header");e.innerText=P(a(this,w)),t.append(e);const i=y("day__content"),n=new H(a(this,v),"dayTable");i.append(n.render()),t.append(i);const r=y("day__statistics"),o=new O;let c=0;return a(this,C).forEach(([l,S])=>{c+=S,o.addCategory(l,S)}),o.addTotal(c),r.append(o.render()),t.append(r),t}}w=new WeakMap,v=new WeakMap,C=new WeakMap;var b,T;class N{constructor(t,e){p(this,b);p(this,T);f(this,T,t),f(this,b,[...e].toSorted((i,n)=>n[1]-i[1]))}render(){const t=y("totalStatistics"),e=u("h1","totalStatistics__title");e.innerText=a(this,T),t.append(e);const i=u("h2","totalStatistics__subtitle");i.innerText="Общая статистика",t.append(i);const n=u("button","totalStatistics__close");n.innerHTML=`<svg class="totalStatistics__close-img" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18 35.75C8.19695 35.75 0.25 27.8031 0.25 18C0.25 8.19695 8.19695 0.25 18 0.25C27.8031 0.25 35.75 8.19695 35.75 18C35.75 27.8031 27.8031 35.75 18 35.75Z"  stroke="#CDCDCD" stroke-width="0.5"/>
<path d="M26 9.36753L9 26M9 9L26 25.6325" stroke="black"/>
</svg>
`,t.append(n),n.addEventListener("click",()=>{document.querySelector("#statisticsContainer").childNodes.forEach(c=>{c.remove()}),d("#initialContent").classList.remove("d-none"),location.search&&(location.search="")});const r=new O;let o=0;return a(this,b).forEach(([c,l])=>{o+=l,r.addCategory(c,l)}),r.addTotal(o),t.append(r.render()),t}}b=new WeakMap,T=new WeakMap;class $ extends Map{constructor(t){super(),Object.values(t).flat().forEach(e=>this.add(e.category,e.value))}add(t,e){this.has(t)?this.set(t,this.get(t)+e):this.set(t,e)}}class R{constructor(){this.handleFileContent=this.handleFileContent.bind(this),this.handleFileDrop=this.handleFileDrop.bind(this),this.handleFileInput=this.handleFileInput.bind(this),this.handleJsonSubmit=this.handleJsonSubmit.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),document.addEventListener("dragover",this.handleDragOver),document.addEventListener("dragleave",this.handleDragLeave),document.addEventListener("drop",this.handleFileDrop),d("#file-input").addEventListener("change",this.handleFileInput);const e=new URLSearchParams(location.search).get("source");e?this.handleSource(e):this.showInitialContent()}async handleSource(t){const e=await fetch(t),i=await e.text();e.status===200?this.handleFileContent(i):(alert("Недействительная ссылка"),this.showInitialContent())}showInitialContent(){d(".initialContent").classList.remove("d-none")}hideInitialContent(){d(".initialContent").classList.add("d-none")}handleFileContent(t){try{const e=JSON.parse(t);A(e),d("#initialContent")&&this.hideInitialContent(),this.renderPayments(e)}catch(e){this.showInitialContent(),alert(e.message||"Ошибка при чтении данных. Убедитесь, что данные содержат корректный JSON.")}}handleFileDrop(t){t.preventDefault();const e=t.dataTransfer.files[0];if(!e)return;const i=new FileReader;i.onload=n=>this.handleFileContent(n.target.result),i.readAsText(e)}handleFileInput(t){const e=t.target.files[0];if(!e)return;const i=new FileReader;i.onload=n=>this.handleFileContent(n.target.result),i.readAsText(e)}handleJsonSubmit(){const e=d("#json-input").value.trim();e&&this.handleFileContent(e)}handleDragOver(t){t.preventDefault()}handleDragLeave(t){t.preventDefault()}renderPayments(t){const e=d("#statisticsContainer"),{payments:i,title:n}=t,r=y("container"),o=new $(i),c=new N(n,o);r.append(c.render());const l=u("h2","dailyStatisticsTitle");l.innerText="Статистика по дням",r.append(l),Object.entries(i).forEach(([S,E])=>{const I=new $(E),j=new J(S,E,I);r.append(j.render())}),e.innerHTML="",e.append(r)}}document.addEventListener("DOMContentLoaded",()=>{d(".categories-format-example").innerHTML=Object.entries(D).map(([s,t])=>`<div class="categories-format-example__line">${s} - ${t}</div>`).join(""),d("#loadJsonForm").addEventListener("submit",s=>{s.preventDefault();const t=d("#jsonUrl").value;console.log(t),t&&(location.href=`?source=${t}`)}),new R});
